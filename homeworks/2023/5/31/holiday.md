优化缓存性能是提高程序运行速度的关键技术。

主要的优化方法有:

1. 增强空间局部性:通过调整数据结构和编程方式增加数据的空间相近度,使更多数据可以被缓存在同一缓存块中。常用技术有:

   (1) 使用连续性数据结构:如数组而非链表,使数据连续存储

   (2) 展开循环:生成更长的连续代码与数据访问序列

   (3) 拆分结构体:将最有可能一起访问的成员尽量集中

   (4) 使用块操作:在循环中以块的方式访问数组,增大每个操作的数据量 

2. 增强时间局部性:通过数据与指令的重用增加它们在短时间内被多次访问的机会。常用技术有:

   (1) 复用变量:在循环/函数中尽量复用相同的变量,而非每次新建变量

   (2) 增大循环展开因子:每次展开更长的循环体,避免频繁跳转 

   (3) 函数内联:将短小函数内联到调用点,避免调用开销 

   (4) 循环不变移:将不随迭代变化的计算移到循环外进行,避免重复计算

3. 其他方法: 

   (1) 将频繁使用的数据保存在寄存器中:直接被CPU访问,完全免除访问开销

   (2) 避免访问大数组:在内循环中访问大数组会产生大量缓存未命中,严重影响性能 

   (3) 使用缓存一致性的表现形式:优化多核程序缓存同步性能

   (4) 按照空间局部性组织数据:将最有可能一次一起被访问的数据尽量存储在一起