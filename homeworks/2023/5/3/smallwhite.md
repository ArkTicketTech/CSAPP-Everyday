### 网关

做为其他服务器的中间实体使用。常用于将 `http` 流量转化为其他的协议。网关接受请求时就好像自己本身是资源源服务器一样，客户端对此无感知。根据这个特性，我们可以设置规则，拦截一些不符合要求的网络流量。

![image-20230211163549497.png](https://typra-pictures.oss-cn-beijing.aliyuncs.com/imgs/1676185326-mKCZkW-image-20230211163549497-20230503232608907.png){:width=400}

中国大陆的因特网是一个非常庞大的局域网，当你访问外部的资源时，需要通过局域网的网关服务器，也就是中国大陆的网关服务器，中国国家防火墙`(The Great FireWall(GFW))`，这是一个非常强大的网关服务器，会根据设置的规则拦截网络流量，不仅限于`http/https`流量。

### 隧道

对通信报文进行盲转发的特殊代理，客户端无感知。一般是指`http/https`通信报文。

对两条连接之间的数据进行盲转发，`https`就是通过隧道实现的。`http`连接承载加密的安全套接字层`(ssl,secure sockets layer)流量，这样 ssl 流量就可以直接穿过只允许 web 流量通过防火墙，反正亦然。

![image.png](https://typra-pictures.oss-cn-beijing.aliyuncs.com/imgs/1676641784-sepsRB-image-20230503232610295.png){:width=400}


### 代理

位于客户端和服务器之间的中间实体。出于安全考虑，通常会将代理做为转发所有 `Web` 流量的可信任中间节点使用，也可以对请求和响应进行过滤。

![image-20230211163455530.png](https://typra-pictures.oss-cn-beijing.aliyuncs.com/imgs/1676185243-vcXnCP-image-20230211163455530-20230503232610956.png){:width=400}





### VPN

虚拟专用网`(virtual private network 缩写：VPN)`，可以穿过网关

所以可以通过代理和隧道可以绕过网关设置的规则，但还是要经过网关。

![image-20230503183546149](https://typra-pictures.oss-cn-beijing.aliyuncs.com/imgs/image-20230503183546149.png)

当直接访问局域网外部的资源时

1. 应用客户端发送请求通过网关，根据网关规则，请求可能被拦截。

当通过隧道访问局域网外部的资源时

1. 客户端发送请求。
2. 请求被代理拦截，发送给隧道客户端，客户端对请求进行处理，包括加密等一系列操作。
3. 隧道客户端将处理的请求发送给隧道服务器，根据网关设置的规则对请求进行处理，可以逃过网关的规则。如果规则设置更严苛一点，隧道发送的请求还是无法穿过网关的。
4. 隧道服务端收到请求，解析请求，发送请求给资源服务器，资源服务器返回资源响应，通过相同的方式返回应用客户端。

### 搭建`VPN` 服务器

1. 选择一个在局域网外部的服务器，部署隧道服务。
2. 设备安装隧道客户端，配置连接到对应的隧道服务上。`clash、shadowrockets、openvpn client`等等

注意：客户端和服务器在协议上能匹配上才可以。



- [防火长城 - 维基百科，自由的百科全书 (wikipedia.org)](