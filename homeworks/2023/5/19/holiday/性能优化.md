循环优化是提高程序性能的一种关键技术。它主要通过选择合适的循环展开因子与应用其他优化技术来减少循环执行时间,提高循环效率。主要的优化技术包括:

1. 循环展开:减少循环控制代码的执行次数,提高并行度并长基本块,利于后续优化。需要选择适当的展开因子,权衡代码膨胀。
2. 阻塞:将连续的循环体展开到一个阻塞内,然后对整个阻塞进行优化。这增加了优化的颗粒度,可以在更大的范围内进行优化。例如:

```
c
for (i = 0; i < N; i++) {
  // Loop 1
}
for (j = 0; j < M; j++) {
  // Loop 2 
}
```

可以阻塞为:

```
c 
for (i = 0; i < N; i++) {   // Block 1
  for (j = 0; j < M; j++) {
    // Loop 1
    // Loop 2
  } 
}
```

然后可以对整个Block 1进行循环展开、指令重排等优化。3. 联合展开:当两个循环使用同一变量,并且循环展开因子的最小公倍数较小时,可以将这两个循环联合展开,减少使用该变量的次数。例如:

```
c
for (i = 0; i < 100; i++) {
  // ...
} 
for (j = 0; j < 50; j++) {
  // ...
  x = ...  // Use x
}
```

可以联合展开为: 

```
c
for (i = 0; i < 100; i+=2) {   
  for (j = 0; j < 50; j+=2) {
    // ... 
    x = ...  // Use x
    // ...
  }
}
```

减少使用x的次数,缓解成为性能瓶颈。