# Ch8 Exceptional Control Flow

## 8.2 Processes

### 8.2.5 Context Switches

操作系统内核使用上下文切换的异常控制形式来实现多任务。

内核为每个进程维持一个上下文，上下文就是内核重新启动一个被抢占进程所需的状态，其由一些对象的值组成，包括：通用目的寄存器、浮点寄存器、程序计数器、用户栈、状态寄存器、内核栈和各种内核数据结构（例如描述地址空间的页表、包含当前进程信息的进程表，进程已打开文件的信息的文件表）。

当开始进程调度或发生时钟中断开始切换进程时，上下文切换的步骤如下：

1. 保存当前进程的上下文；
2. 恢复某个先前被抢占的进程保存的上下文；
3. 将控制传递给这个新恢复的进程。

> 当内核代表用户执行系统调用时，也可能会发生上下文切换。如果系统调用会因为某个等待时间发生阻塞，内核可以让当前进程休眠并切换到另一个进程。例如，read 和 sleep 系统调用。