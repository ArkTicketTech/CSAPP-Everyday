# Ch9 VM as a Tool for Caching

## 9.9 Dynamic Memory Allocation

### 9.9.14 Segregated Free Lists

分离存储：维护多个空闲链表，其中每个链表中的块有大致相等的大小，例如，按照 2 的幂次来进行分块。

分配器维护着一个空闲链表数组，每个大小类一个空闲链表，按照大小的升序排列，当分配器需要一个大小为 n 的块时，其搜索相应的空闲链表，如果不能找到合适的块与之匹配，它就搜索下一个链表。

两种方法：简单分离存储（simple segregation storage）和分离适配（segregated fit）

1. 简单分离存储：每个大小的空闲链表包含大小相等的块，每个块的大小就是这个大小类中最大元素的大小。

    如果分配时链表为空，分配器就向操作系统请求一个固定大小的额外内存片，将内存篇划分为大小相等的块，并将这些块链接起来形成新的空闲链表。

    * 优点：分配和释放都是快速的常数操作，不需要额外的标记占用块空间
    * 缺点：易造成内部碎片和外部碎片

2. 分配适配：分配器维护一个空闲链表数组，每个空闲链表被组织成某种类型的显示或隐式链表。

    如果空闲链表中没有合适的块，那么就向操作系统请求额外的堆内存，从这个新的堆内存中分配出一个块，将剩余部分放置在适当的大小类中。要释放一个块时执行合并，将结果放置到相应的空闲链表中。

    GNU malloc 采样该方法

3. 伙伴系统：
    * 优点：快速搜索和快速合并
    * 缺点：要求块大小为 2 的幂可能导致显著的内部碎片；且不适合通用目的的工作负载
