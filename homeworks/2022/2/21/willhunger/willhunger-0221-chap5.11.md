# Ch5 Optimizing Program Performance

## 5.11 Some Limiting Factors

**5.11.1 Register Spilling**

提升循环中的并行性是存在限制的，当并行性超过了可用的寄存器的数量时，编译器会产生寄存器溢出（register spilling），此时寄存器会将值存在运行时栈中分配内存，但后续循环需要访问内存，这样使得并行优化的优势直接消失。

> x86-64 有足够的寄存器，大多数循环可以在寄存器溢出之前达到吞吐量限制。

**5.11.2 Branch Prediction and Misprediction Penalties**

分支预测分为两种情况，条件转移的情况下意味着预测是否需要选择分支，间接跳转或函数调用返回的情况下，需要预测目标指令的地址。本节分析了条件转移的情况。

使用投机执行（speculative execution）的处理器，其执行的分支预测指令，会避免修改实际寄存器和内存位置，直到确定了实际结果。

x86 处理器有条件传送指令，在编译条件语句和表达式时，GCC 能使用条件传送指令，条件传送指令可以被实现为普通指令流水线化处理的一部分，没有必要去猜测条件。



