# Ch9 VM as a Tool for Caching

## 9.8 Memory Mapping

### 9.8.2 The fork Function Revisited

当 fork 函数被当前进程调用时，内核为新进程创建各种数据结构，并分配一个唯一的 PID，为了给这个新进程创建虚拟内存，会创建进程的 mm_struct、区域结构和页表的原样副本，其将两个进程中的每个页面都标记为只读，并将两个进程中的每个区域结构都标记为私有的写时复制。

当 fork 在新进程中返回时，新进程的虚拟内存和调用 fork 时的虚拟内存相同，当两个进程中的任一个后来进行写操作时，写时复制机制用来创建新页面，以此保持了私有地址空间的抽象概念。