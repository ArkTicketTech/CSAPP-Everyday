# Ch8 Exceptional Control Flow

## 8.5 Signals

### 8.5.5 Writing Signal Handlers

#### 1. 安全的信号处理

保守的信号处理规则：

* 处理程序尽可能简单。例如，处理程序仅仅设置全局标志并返回，所有接受信号相关的处理都由主程序执行，它周期性地检查（并重置）这个标志。
* 处理程序中调用异步信号安全的函数。
* 保存和恢复 errno。在进入处理程序时把 errno 保存在全局变量中，在处理程序返回前恢复它。
* 阻塞所有信号，保护对全局数据结构的访问。如果对全局数据结构时被中断，很有可能发生不可预知的结果。
* 用 `volatile` 声明全局变量。
* 用 `sig_atomic_t` 声明标志，保证其读和写的操作时原子的且不可中断的（针对单指令的读和写）。